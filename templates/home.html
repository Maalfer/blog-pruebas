{% extends "base.html" %}

{% block title %}Inicio - Blog de Ciberseguridad{% endblock %}

{% block content %}
<div class="row">
    <div class="col-12 text-center mb-5">
        <div class="d-flex flex-column flex-md-row align-items-center justify-content-center gap-3">
            <h1 class="display-5 m-0 text-glow-animate">üõ°Ô∏è Blog de Ciberseguridad</h1>
            <form class="d-flex" role="search" method="get" action="{{ url_for('home') }}" id="search-form" style="max-width: 520px; width: 100%;">
                <input
                    class="form-control me-2"
                    id="q"
                    name="q"
                    type="search"
                    placeholder="Buscar por t√≠tulo, descripci√≥n o categor√≠a..."
                    aria-label="Buscar"
                    value="{{ q|default('') }}"
                    autocomplete="off"
                >
                <button class="btn btn-outline-primary" type="submit">Buscar</button>
            </form>
        </div>
        
    </div>
</div>


<div class="row mt-5">
    <div class="col-md-3 col-6 text-center">
        <div class="card glass-effect">
            <div class="card-body">
                <h3 class="text-red-glow">{{ posts|length }}</h3>
                <p class="mb-0 text-muted-red">üìÑ Posts</p>
            </div>
        </div>
    </div>
    <div class="col-md-3 col-6 text-center">
        <div class="card glass-effect">
            <div class="card-body">
                <h3 class="text-red-glow">
                    {% set authors = [] %}
                    {% for post in posts %}
                        {% if post.author not in authors %}
                            {% set _ = authors.append(post.author) %}
                        {% endif %}
                    {% endfor %}
                    {{ authors|length }}
                </h3>
                <p class="mb-0 text-muted-red">üë• Autores</p>
            </div>
        </div>
    </div>
    <div class="col-md-3 col-6 text-center">
        <div class="card glass-effect">
            <div class="card-body">
                <h3 class="text-red-glow">
                    {% set cats = [] %}
                    {% for post in posts %}
                        {% if post.category not in cats %}
                            {% set _ = cats.append(post.category) %}
                        {% endif %}
                    {% endfor %}
                    {{ cats|length }}
                </h3>
                <p class="mb-0 text-muted-red">üìÇ Categor√≠as</p>
            </div>
        </div>
    </div>
    <div class="col-md-3 col-6 text-center">
        <div class="card glass-effect">
            <div class="card-body">
                <h3 class="text-red-glow">{{ posts|length * 3 }}</h3>
                <p class="mb-0 text-muted-red">‚ù§Ô∏è Comunidad</p>
            </div>
        </div>
    </div>
</div>

<div id="posts-grid">
    {% include 'partials/_posts_grid.html' %}
</div>


<script>
(function() {
    const input = document.getElementById('q');
    const grid = document.getElementById('posts-grid');
    const form = document.getElementById('search-form');

    let t = null;

    function update(q) {
        const url = new URL('{{ url_for("search") }}', window.location.origin);
        if (q) url.searchParams.set('q', q);
        fetch(url, { headers: { 'X-Requested-With': 'XMLHttpRequest' } })
            .then(r => r.text())
            .then(html => { grid.innerHTML = html; })
            .catch(() => {});
    }

    input.addEventListener('input', function() {
        const q = this.value.trim();
        if (t) clearTimeout(t);
        t = setTimeout(() => update(q), 300);
    });

    form.addEventListener('submit', function(e) {
        e.preventDefault();
        update(input.value.trim());
        const params = new URLSearchParams(window.location.search);
        if (input.value.trim()) {
            params.set('q', input.value.trim());
        } else {
            params.delete('q');
        }
        const newUrl = `${window.location.pathname}?${params.toString()}`;
        window.history.replaceState({}, '', newUrl);
    });
})();
</script>
{% endblock %}
